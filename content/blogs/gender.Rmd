---
categories:
- ""
- ""
date: "2017-10-31T22:26:09-05:00"
description: ""
draft: false
image: jp-valery-unsplash.jpg
keywords: ""
slug: gender
title: Gender pay analysis
---

```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)

# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center"
)
```


```{r load-libraries, echo=FALSE}
library(tidyverse)  # Load ggplot2, dplyr, and all the other tidyverse packages
library(mosaic)
library(ggthemes)
library(GGally)
library(readxl)
library(here)
library(skimr)
library(janitor)
library(broom)
library(tidyquant)
library(infer)
library(openintro)
library(stringr)
library(ggpubr)
library(ltm)
```

# Omega Group plc- Pay Discrimination

## Loading the data

```{r load_omega_data}
omega <- read_csv(here::here("data", "omega.csv"))
glimpse(omega) # examine the data frame
```


## Relationship Salary - Gender ?

The data frame `omega`  contains the salaries for the sample of 50 executives in the company. Can you conclude that there is a significant difference between the salaries of the male and female executives?

Note that you can perform different types of analyses, and check whether they all lead to the same conclusion 

.	Confidence intervals
.	Hypothesis testing
.	Correlation analysis
.	Regression

Calculate summary statistics on salary by gender. Also, create and print a dataframe where, for each gender, you show the mean, SD, sample size, the t-critical, the SE, the margin of error, and the low/high endpoints of a 95% condifence interval

```{r, confint_single_valiables}
# Summary Statistics of salary by gender
mosaic::favstats (salary ~ gender, data=omega)

#create dataframe
salary_gender <- omega %>% 
  #group by gender (male-female) to have two rows
  group_by(gender) %>% 
  #add summary statistics and confidence interval endpoints
  summarise(mean_salary = mean(salary),
            sd_salary = sd(salary),
            count=n(),
            t_critical = qt(0.975, count-1),
            se_salary = sd_salary/sqrt(count),
            margin_of_error = t_critical*se_salary,
            lower = mean_salary-margin_of_error, #include confidence intervals
            higher = mean_salary+margin_of_error)
#print dataframe
salary_gender

#conduct correlation analysis
biserial.cor(omega$salary, omega$gender)

```


> What can you conclude from your analysis? A couple of sentences would be enough

The above analysis provides us with the lower and upper bounds of a 95% confidence interval for salaries, based on gender. From an initial glance at this data, we observe that the intervals do not overlap, a signal that further analysis should be conducted to determine if this difference between salary and gender is statistically significant. The biserial.cor function allowed us to calculate the correlation between a dichotomous variable (male, female) and salaries. The correlation came out to -0.508, signifying that the two variables are relatively related but in a negative way.

You can also run a hypothesis testing, assuming as a null hypothesis that the mean difference in salaries is zero, or that, on average, men and women make the same amount of money. You should tun your hypothesis testing using `t.test()` and with the simulation method from the `infer` package.

```{r, hypothesis_testing}
# hypothesis testing using t.test() 
t.test(salary ~ gender, data=omega)

# hypothesis testing using infer package
set.seed(1234)

salary_vs_gender <- omega %>% #pull from main dataframe
  
  #specify variable of interest
  specify(salary ~ gender) %>% 
  
  #hypothesize a null of zero difference
  hypothesize(null = "independence") %>% 
  
  #generate a bunch of simulated samples
  generate(reps=1000, type="permute") %>% 
  
  #find the mean difference of each sample
  calculate(stat = "diff in means", 
            order = c("male", "female"))

salary_vs_gender %>% visualize()
salary_vs_gender %>% 
  get_pvalue(obs_stat = (73239-64543), direction = "both")

```


> What can you conclude from your analysis? A couple of sentences would be enough

From the two hypothesis tests, it can be concluded that there is a significant difference among salaries based on gender (male vs female).
In the two sample t-test, the resulting t-stat was -4 and the p-value was way below 0.05 at 2e-04. Additionally, the confidence interval did not contain zero. These three statistics, tell us to reject the null hypothesis, which was that the difference in salaries was not related to gender. Finally, the hypothesis test using the infer package, also led to a p value of 0, confirming our above conclusion. 

## Relationship Experience - Gender?

At the board meeting, someone raised the issue that there was indeed a substantial difference between male and female salaries, but that this was attributable to other reasons such as differences in experience. A questionnaire send out to the 50 executives in the sample reveals that the average experience of the men is approximately 21 years, whereas the women only have about 7 years experience on average (see table below).

```{r, experience_stats}
# Summary Statistics of salary by gender
favstats (experience ~ gender, data=omega)

#create dataframe
gender_exp <- omega %>% 
  #group by gender (male-female) to have two rows
  group_by(gender) %>% 
  #add summary statistics and confidence interval endpoints
  summarise(mean_exp = mean(experience),
            sd_exp = sd(experience),
            count=n(),
            t_critical = qt(0.975, count-1),
            se_exp = sd_exp/sqrt(count),
            margin_of_error = t_critical*se_exp,
            lower = mean_exp-margin_of_error, #include confidence intervals
            higher = mean_exp+margin_of_error)
#print dataframe
gender_exp

# hypothesis testing using t.test() 
t.test(experience ~ gender, data=omega)

# hypothesis testing using infer package
set.seed(1234)

gender_vs_exp <- omega %>% #pull from main dataframe
  
  #specify variable of interest
  specify(experience ~ gender) %>% 
  
  #hypothesize a null of zero difference
  hypothesize(null = "independence") %>% 
  
  #generate a bunch of simulated samples
  generate(reps=1000, type="permute") %>% 
  
  #find the mean difference of each sample
  calculate(stat = "diff in means", 
            order = c("male", "female"))

gender_vs_exp %>% visualize()
gender_vs_exp %>% 
  get_pvalue(obs_stat = (21.12-7.38), direction = "both")

```


Based on this evidence, can you conclude that there is a significant difference between the experience of the male and female executives? Perform similar analyses as in the previous section. Does your conclusion validate or endanger your conclusion about the difference in male and female salaries?  

This data seems to tell us that there is a significant difference between the experience of male and female executives. Some of the main statistics in the output that led us to this conclusion were the t-stat of -5, p-value of 1e-05, and the 95% confidence interval not containing zero. Unfortunately, this conclusion endangers our early conclusion that the difference in salaries among executives was based on gender. Now, further analysis is required to see if it is because of only gender, or if it is because male executives tend to have more years of experience than female executives. 


## Relationship Salary - Experience ?

Analyse the relationship between salary and experience. Draw a scatterplot to visually inspect the data


```{r, salary_exp_scatter}
ggplot(omega, aes(x=experience, y=salary)) +
  geom_point(aes(color=gender)) + 
  geom_smooth() +
  labs(title = "Salary vs Experience in the Workplace",
       x="Years of Experience",
       y="Salary") +
  theme_minimal()

```


This scatterplot shows the upward trending slope where more years of experience typically equates to a higher salary. Additionally, with the colored dots, it is possible to see that women tend to less years of experience compared to the men, but the women who do have equivalent higher years of experience as men tend to be paid in a similar range.


## Check correlations between the data
You can use `GGally:ggpairs()` to create a scatterplot and correlation matrix. Essentially, we change the order our variables will appear in and have the dependent variable (Y), salary, as last in our list. We then pipe the dataframe to `ggpairs()` with `aes` arguments to colour by `gender` and make ths plots somewhat transparent (`alpha  = 0.3`).

```{r, ggpairs}
omega %>% dplyr::select(gender, experience, salary) %>%  #order variables they will appear in ggpairs()
  ggpairs(aes(colour=gender, alpha = 0.3))+
  theme_bw()
```


> Look at the salary vs experience scatterplot. What can you infer from this plot? Explain in a couple of sentences

Men have sifnificantly more experience in the workplace as their experience boxplot does not overlap with that of females. This also results in a higher median salary as a result, however with wage, the boxplots for male and female are overlapping so its unsure if there is a statistically significant difference in male vs. female salaries.